PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin

set > /home/alarm/relay/cronlogs/archiverlytrans

instid=`/home/alarm/relay/scripts/generateinstanceid.sh`
timestm=`date`

# Copy relay events into database archive table
mysql -uroot -pwelcome relaydb <<EOF

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
SET autocommit=0;
START TRANSACTION;
INSERT INTO tblarchivedrelaytrans (instanceid, gpiopin, device, switchmode, triggersource, timestamp)
  SELECT instanceid, gpiopin, device, switchmode, triggersource, timestamp from tblrelaytransactions;
TRUNCATE tblrelaytransactions;
COMMIT;            

EOF

echo "Relay transactions for Instance Id $instid succesfully archived at $timestm"
